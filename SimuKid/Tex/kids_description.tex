
\section{Kinetic Inductance Detectors}
\label{se:kids}


%\subsection{Presentation rapide des detecteurs}
%\subsection{Photometrie}
%\subsubsection{Rf}
%\subsubsection{Cf}
%
%\subsection{Non linearite par l'observation d'une source ponctuelle}

%%%%



Kinetic Inductance Detectors (KID) are a novel superconducting detector technology
that provides high sensitivity and ease of multiplexing. In this section we give
a brief summary of their main features and how photometry can be derived from
their measurements.

\subsection{Transfer function}

KIDs are RLC superconducting resonators made from a thin metal film. When
photons are absorbed by the superconducting film, they break Cooper pairs which
increases the quasi-particles density and causes a change in the kinetic
inductance $L_{k}$. This produces a shift $\delta f_{0}$ of the resonant
frequency of the KID \citep{2013A&A...551L..12C} that can be related to the
absorbed optical power $\delta P_{opt}$ (cf.~Fig.~\ref{fig:resonance}). This
relation is linear for small variations in $P_{opt}$
\citep{2010ApPhL..96z3511S}. The KID transfer function is given by:

\begin{equation}
S_{21}(f) = \mathcal{I} +j\mathcal{Q} .
\end{equation}

\noindent where $\mathcal{I}$ and $\mathcal{Q}$ give respectively the real (in phase) and imaginary
(quadrature) of $S_{21}$. A model of a KID transfer function has been proposed
by \citet{2008ApPhL..93m4102G} :

\begin{equation}
S_{21} = \frac{2Z_{res}Z_{0}}{Z_{res}[2Z_{0} + j(X_{1}+X_{2})] + (Z_{0} +jX_{1})(Z_{0} +jX_{2})},
\end{equation}

with:

\begin{equation}
Z_{res} = \frac{Z_{0}Q_{e}}{2Q_{i}}[1 + 2jQ_{i}\frac{(f-f_{0})}{f_{0}}],
\end{equation}

\noindent where $X_{1}$, $X_{2}$, $Z_{0}$ are impedances, $Q_{i}$ is the
intrinsic quality factor of the resonator and $Q_{e}$ is the external quality
factor due to coupling with the measurement electronics. $f$ is the frequency of
excitation of the detector, and $f_{0}$ is the resonant frequency. Throughout
this paper, we shall assume typical values of KIDs $X_{1} = X_{2} =
0.5\,\Omega$, $Z_{0} = 50\,\Omega$, $Q_i=2\times 10^4$, $Q_e=10^4$ and $f_{0} =
1.8\times 10^9$\,Hz as measured on \nika\ and \nikad. The following section
addresses how the resonance of a KID is monitored and related to the incident
optical power.

\begin{figure}
  \includegraphics[clip, angle=0, width=\columnwidth]{Figures/resonance.png}
  %	\includegraphics[clip, angle=0, width=\columnwidth]{Figures/resonance.pdf}
  \caption{Schematic representation of a KID resonance in amplitude (left) and phase (right), as a function of the excited tone injected in the feedline. The optical power absorbed by the detector is weak for black curves and increases for red curves. The absorption of a photon shifts the resonance frequency and this is directly proportional to the received power.}
  \label{fig:resonance}
\end{figure}



% \section{Methods of signal reconstruction}
\subsection{Photometry}
\label{sec:signal}

A dedicated KID readout system has been developed by \citet{2013A&A...551L..12C}
and successfully used for \nika\ and \nika2\ \citep{2010A&A...521A..29M,2016JLTP..184..816C}. We here summarize its main charcteristics and the observables
that are relevant for our simulation work. We then present two ways to use them
to derive the photometry.

%% To convert the $\I(t)$ and $\Q(t)$ that
%% describe the resonance frequency shift $\delta f_0$ to the absorbed optical
%% power $\delta P_{opt}$. We have devised two ways to relate these
%% quantities. Both rely on a specific electronic modulation readout devised by
%% \citet{2013A&A...551L..12C} that we summarize first.

\subsubsection{Modulated readout technique}

\begin{figure}
  \includegraphics[clip,angle=0,width=\columnwidth]{Figures/resonance-circle.png}
  \caption{Trajectory of $\I$ and $\Q$ during a frequency sweep around the
    resonance of a KID. The arrows represent $(\di,
    \dq)$. \citep{2013A&A...551L..12C}}
  \label{circle-iq}
\end{figure}

The excitation tone frequency of a KID is modulated by a local oscillator with a
known frequency shift. This provides two values $f_{\pm} = f_0 \pm \delta
  f_{LO}/2$ with $\delta f_{LO} \simeq 1$\,kHz. The ``In-phase'' in
``in-Quadrature'' amplitudes $i(t)$ and $q(t)$ then read:

\begin{equation}
(i(t), q(t)) = (\frac{i(f_{+}) +
    i(f_{-})}{2},
\frac{q(f_{+}) + qf_{-})}{2}),
\end{equation}

and the differential values are :

\begin{equation}
\label{gradient}
(\di(t), \dq(t)) =
\left(\frac{i(f_{+}) - i(f_{-})}{\delta f_{LO}},
\frac{q(f_{+}) - q(f_{-})}{\delta f_{LO}}\right).
\end{equation}

These quantities are represented on Fig. \ref{circle-iq}. In this paper, we take
typical laboratory values and assume that $i$ and $q$ are sampled at
880\,Hz. This high acquisition rate is allowed by the sub-millisecond time
constant of the KIDs. For most experiments, such a high sampling rate is not
required and we average these measures over 40~samples to produce
four secondary quantities at 22\,Hz:

\begin{eqnarray}
\I  &=& \sum^{N_{m}=40}_{p=1} i_{p},\\
\Q  &=& \sum^{N_{m}=40}_{p=1} q_{p},\\
d\I &=& \sum^{N_{m}/2=20}_{p=1} i_{2p} - i_{2p-1},\\
d\Q &=& \sum^{N_{m}/2=20}_{p=1} q_{2p} - q_{2p-1}.
\end{eqnarray}

With these quantities in hand we have several ways to derive the transmitted
signal. They are presented in the following paragraph.

\subsubsection{\rf}
If a variation $\Delta\I(t)$, $\Delta\Q(t)$ is observed between successive ($\I$,
$\Q$) points, it is possible to estimate the shift of the resonant frequency
$\Delta f_{0}$ between these two samples by comparing ($\Delta \I$, $\Delta \Q$)
with the gradient $(\di,\dq)$ induced by the known $\delta
f_{0}$ of the local oscillator. This is done by a scalar projection of ($\Delta\I$,
$\Delta\Q$) on $(\di,\dq)$ that is tangent to the resonance circle. To have a
cleaner estimation of the latter, we take its running average over 50
points that we write $\langle . \rangle_{50}$ \citep{2014A&A...569A...9C}:

\begin{equation}
\label{eq:Rf}
\Delta f_{0} = \delta f_{LO} \frac{\Delta \I\, \langle \di
  \rangle_{50}
+ \Delta \Q\, \langle \dq \rangle_{50}}{\langle \di
  \rangle_{50}^{2}
 + \langle \dq \rangle_{50}^{2}},
\end{equation}

Note that this average is performed only on the tangent vector $(\di,\dq)$ so
that $\Delta f_0$ is sampled like $\I$ and $\Q$ at 22\,Hz. This method has been
successfully used in \todo{XXXX}, but can be affected by some systematic
uncertainty and be a source of non-linearity. Indeed, $(\di,\dq)$ is tangent to
the $(\I,\Q)$ circle for a fixed background optical power, while, in principle,
the incident optical power that induces the observable $(\Delta \I, \Delta \Q)$
should distort the resonance circle to some extent. As a consequence, the
observed $(\I,\Q)$ trajectory is not precisely parallel to the $(\di,\dq)$
direction. Early laboratory and on-site tests have shown that this approximaton
leads to a reconstruction of point source fluxes better than 2\%
\citep{2013A&A...551L..12C}. In this work, we improve this upper limit on
simulations and assess the impact of this error on futures CMB polarization
measurements.

\subsubsection{Circle fit : Cf}

\begin{figure}
\includegraphics[clip, angle=0, width=\columnwidth]{Figures/circle_zres.eps}
\caption{Bottom: location of $\I$ and $\Q$ when a KID observes a point source of
  various fluxes. Top: ratio of the distance between $(\I,\Q)$ and the center of
  the fitted circle over the radius of this circle. All the points on the pure
  imaginary line at $\I=1$ are the result of the transformation of the circle
  into $Z_{res}$ according to eqs.~(\ref{eq:z_res}) and
  (\ref{eq:scale_rotate}).}
\label{fig:circle_zres}
\end{figure}

\todo{ref to the circular nature of (I,Q): \cite{2011ApJS..194...24M}}.\\

To improve \rf, we developed a new technique that fully exploits the circular
nature of the $(\I,\Q)$ trajectory, hereafter called \cf. It is
  based on the transformation property of a circle in the complex plane into a
  straight line. Indeed, let us consider a circle centered on $(0,1/2)$ with a
  radius $1/2$ and compute its inverse:

\begin{eqnarray}
Z_{ref} &\equiv&\frac{1}{2} + \frac{1}{2}e^{i\phi}\,, \\
&=&\cos\frac{\phi}{2}e^{i\phi/2}\,,\\
Z_{res} &\equiv& 1/Z_{ref}\,, \label{eq:z_res} \\
&=&1-i\tan\frac{\phi}{2}\,.
\label{eq:z_res}
\end{eqnarray}

$Z_{res}$ is a straight line and along this line $Z$ varies linearly with
$\phi$ for small values of $\phi$. Experimentally, we are in this regime
when the signal is weak and when $\phi$ is defined w.r.t.~ the $(O,C)$ axis
as defined on Fig.~\ref{fig:circle_zres}. We thus fit the radius $r$ and the
center $(\I_c,\Q_c)$ of our measurement circle $Z=\I+j\Q$. Defining
$\alpha=\arctan\Q_c/\I_c$, we scale, rotate and translate this
circle to the $Z_{res}$ circle according to

\begin{equation}
Z_{ref} = \left(\begin{array}{c}
\I_{ref}\\
\Q_{ref}\end{array}\right) = 
\frac{-1}{2r}\left(\begin{array}{rr}
\cos\alpha & \sin\alpha\\
-\sin\alpha & \cos\alpha\end{array}\right)
\left(\begin{array}{c}
\I-\I_c\\
\Q-\Q_c\end{array}\right) +
\left(\begin{array}{c}
1/2\\
0\end{array}\right)
\label{eq:scale_rotate}
\end{equation}

The result of this transformation is shown on Fig.~\ref{fig:circle_zres}. A
variation of the signal $(\Delta\I,\Delta\Q)$ leads to a variation
$\Delta\phi$ along $Z$ that is proportional to the frequency shift $\Delta f$
that we are after to determine photometry. To derive the calibration between
these two quantities, we once again rely on the $(\di,\dq)$ that is induced by
the known $\delta f_{LO}$. Applying transformation (\ref{eq:scale_rotate}) to
$(\di,\dq)$, we obtain the corresponding variation $dy = Im(dZ_{res})$. The
final derivation of $\Delta f$ corresponding to $(\Delta\I,\Delta\Q)$ requires
the integration of $dy/\delta f_{LO}$. For the sake of simplicity, we fit
$Im(dZ_{res})$ as a polynomial of $dy/\delta f_{LO}$ that is therefore trivial
to integrate.

%% \begin{equation}
%% \tan\frac{\delta\phi}{2} \simeq \frac{\delta\phi}{2} +
%% \frac{(\delta\phi)^3}{15}
%% \end{equation}

\subsection{Non linearity characterization with simulations of observations of a point source}

\begin{figure}
\center
\includegraphics[clip, angle=0, width=\columnwidth]{Figures/KID-linearity-Monfardini2014.png}
\caption{KID linearity demonstrated in laboratory under realistic
  conditions. The plot shows the frequency shift of the resonance as a function
  of the optical background temperature (K). Solid line : linear fit of the
  experimental points. Credits : \citet{2014JLTP..176..787M}.}
\label{fig:KID-lin}
\end{figure}

Laboratory measurements with \todo{XXXX describe set up XXX} have shown that
KIDs are linear over a wide range of backgrounds
(Fig.~\ref{fig:KID-lin}). However, for these measurements, $\Delta f$ was not
reconstructed as described in the previous section, and we want to characterize
our formalism up to $\epsilon$ of the order of $10^{-5}-10^{-6} $ TBC.

To characterize KIDs non linearity, we write the non linear detector response as :

\begin{equation}
m^{Rf,Cf} = m + \varepsilon m^2 +c_{0}.
\label{eq:model_kid_nl}
\end{equation}

$\varepsilon$ represents the non linearity of the KID.


We simulate
the measure of point source by a KID and show how linear this measure remains in
various contexts. Non linearity could appear when the source is very bright
(such as planets of several tens of Jy) and the density of charge carriers is
altered. This leads to $(\I,\Q)$ measures that leave the resonance circle, hence
invalidating the approximations made in the photometric equations of the
previous section. A second possible source of non linearity is the instrument
scanning speed. Indeed, even if the source is moderately bright, if it is
scanned too fast, $(\Delta\I,\Delta\Q)$ could be far from the tangent vector
$(\di,\dq)$ which would alter their linear relation. In this paragraph, we
explore both cases.\\

We simulate the observation of a point source with a flux
that we vary between \todo{1 and 2000\,Jy TBC} (fluxes are unrealistically large on purpose for illustration). We assume that our instrument has
a 11\,arcsec FWHM Gaussian beam like the polarized 1\,mm channel of \nikad. We
also vary the scanning speed of our virtual instrument while keeping a minimum
of 3~samples per FWHM to respect the Nyquist criterion.
As shown in Fig.~\ref{fig:planet_profiles} and Fig.~\ref{fig:flux_out_vs_in}, non linearity appears with the distortion of the input gaussian profile in the case of \rf\ method whereas \cf\ remains linear on the same flux scale.

\begin{figure}
  \includegraphics[clip, angle=0, width=\columnwidth]{Figures/planet_profiles.eps}
  \caption{Comparison of an incoming flux that we vary between 1 and 2000 Jy TBC (in black), with flux reconstructed by \rf\ and \cf. Fluxes are unrealistically large on purpose for illustration. }
  \label{fig:planet_profiles}
\end{figure}


\begin{figure}
  \includegraphics[clip, angle=0, width=\columnwidth]{Figures/flux_out_vs_in.eps}
  \caption{Comparison of an incoming flux that we vary between 1 and 2000 Jy TBC (in black), with flux reconstructed by \rf\ and \cf. Fluxes are unrealistically large on purpose for illustration. }
  \label{fig:flux_out_vs_in}
\end{figure}

For all simulations we computed the non-linearity coefficient $\varepsilon$ from eq.~\ref{eq:model_kid_nl} by doing a fit of the input fluxes as a fonction of output fluxes. Results are shown in Tab.~\ref{tab:eps}. As in the two figures the non-linearity coefficients show \rf\ method is less linear than \cf\ on the same flux scale.

\begin{table}
\center
\begin{tabular}{|c|c|c|}
	\hline
	    & $\frac{3pts}{beam}$ & $\frac{5pts}{beam}$ \\
	\hline
\rf\	&  $-4.58 \times 10^{-5}$ & $-2.33 \times 10^{-5}$ \\
	\hline
\cf\ & $1.09 \times 10^{-7}$   & $8.90 \times 10^{-8}$ \\
	\hline
\end{tabular}
\caption{Non-linearity coefficients $\varepsilon$ from an incoming flux that we vary between 1 and 500 Jy.}
\label{tab:eps}
\end{table}

Simulations of a KID exposed to a point source with a large variation of fluxes have shown that it meets the requirement addressed in Sec.~\ref{sec:cmb}. 
HWP presente bcp d'avantages pour les futurs experiences cmb, dans la prochaine section on regarde la NL induite par la HWP. 
